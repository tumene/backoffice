<link
  rel="stylesheet"
  href="https://fonts.sandbox.google.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
/>

<mat-card class="mb-3">
  <div class="d-flex justify-content-between p-1">
    <div class="d-flex justify-content-start">
      <div>Transaction Configuration</div>
    </div>
  </div>
</mat-card>

<mat-card class="mb-3">
  <div class="p-1 pb-2">Select Transaction type</div>
  <mat-divider></mat-divider>
  <mat-card-content class="p-3">
    <div class="row gx-0">
      <div class="col-md-4">
        <mat-form-field appearance="fill" class="input-width">
          <mat-label>Transaction type</mat-label>
          <mat-select id="transaction-type" name="approval">
            <mat-option
              *ngFor="let data of transactionType"
              [value]="data"
              class="p-4"
              (click)="setSelectedTransferType(data)"
            >
              {{ data.name }}
              <mat-divider></mat-divider>
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>expand_more</mat-icon>
        </mat-form-field>
      </div>
    </div>
  </mat-card-content>
</mat-card>
<form
  autocomplete="off"
  *ngIf="selectedTransferType"
  [formGroup]="transactionConfigurationForm"
>
  <mat-card class="mb-3" *ngIf="selectedTransferType">
    <div class="p-1 pb-2">{{ selectedTransferType?.name }}</div>
    <mat-divider></mat-divider>
    <mat-card-content class="m-0 p-3">
      <div class="d-flex flex-column">
        <div class="row pt-4">
          <div class="col-md-3">
            <mat-form-field appearance="fill" class="input-width">
              <mat-label>Unit / Subsidiary*</mat-label>
              <mat-select
                formControlName="subsidiary"
                id="subsidiary"
                name="subsidiary"
              >
                <mat-option
                  *ngFor="let data of subdiaries"
                  [value]="data.code"
                  class="p-4"
                >
                  {{ data.name }}
                  <p>
                    <small class="text-grey">{{ data.subtext }}</small>
                  </p>
                  <mat-divider></mat-divider>
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>expand_more</mat-icon>
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field
              appearance="fill"
              style="width: 100%"
              floatLabel="always"
            >
              <mat-label>Currency</mat-label>
              <input
                formControlName="currency"
                id="currency"
                name="currency"
                matInput
              />
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field
              appearance="fill"
              style="width: 100%"
              floatLabel="always"
            >
              <mat-label>Minimum Transaction Amount</mat-label>
              <input
                formControlName="minTransAmount"
                id="minTransAmount"
                name="minTransAmount"
                matInput
              />
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field
              appearance="fill"
              style="width: 100%"
              floatLabel="always"
            >
              <mat-label>Max Transaction Amount</mat-label>
              <input
                formControlName="maxTransAmount"
                id="maxTransAmount"
                name="maxTransAmount"
                matInput
              />
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field
              appearance="fill"
              style="width: 100%"
              floatLabel="always"
            >
              <mat-label>Charges</mat-label>
              <input
                formControlName="charge"
                id="charge"
                name="charge"
                matInput
              />
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="fill" class="input-width">
              <mat-label>Charge Event*</mat-label>
              <mat-select
                formControlName="chargeEvent"
                id="chargeEvent"
                name="chargeEvent"
              >
                <mat-option
                  *ngFor="let data of chargeEvents"
                  [value]="data.id"
                  class="p-4"
                >
                  {{ data.name }}
                  <p>
                    <small class="text-grey">{{ data.subtext }}</small>
                  </p>
                  <mat-divider></mat-divider>
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>expand_more</mat-icon>
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field
              appearance="fill"
              style="width: 100%"
              floatLabel="always"
            >
              <mat-label>Min Amount for Document Attached</mat-label>
              <input
                formControlName="minAmtForDoc"
                id="minAmtForDoc"
                name="minAmtForDoc"
                matInput
              />
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field appearance="fill" class="input-width">
              <mat-label>Area*</mat-label>
              <mat-select formControlName="area" id="area" name="area">
                <mat-option
                  *ngFor="let data of areas"
                  [value]="data.id"
                  class="p-4"
                >
                  {{ data.name }}
                  <p>
                    <small class="text-grey">{{ data.subtext }}</small>
                  </p>
                  <mat-divider></mat-divider>
                </mat-option>
              </mat-select>
              <mat-icon matSuffix>expand_more</mat-icon>
            </mat-form-field>
          </div>
          <div class="col-md-3">
            <mat-form-field
              appearance="fill"
              style="width: 100%"
              floatLabel="always"
            >
              <mat-label> Bank Charges</mat-label>
              <input
                formControlName="bankCharges"
                id="bankCharges"
                name="bankCharges"
                matInput
              />
            </mat-form-field>
          </div>
        </div>
        <div class="row pt-3">
          <div class="col-md-8">
            <p>Mandatory Document Attachment for exceeded threshold</p>
          </div>
          <div class="col-md-4">
            <mat-radio-group formControlName="mandateDoc">
              <mat-radio-button
                [value]="true"
                fxLayout="row"
                style="margin-right: 20px"
              >
                Yes
              </mat-radio-button>
              <mat-radio-button [value]="false" fxLayout="row">
                No
              </mat-radio-button>

              <!-- other items not shown -->
            </mat-radio-group>
          </div>
        </div>
        <hr />
        <div class="row pt-3">
          <div class="col-md-8">
            <p>None Straight Through Processing (NSTP) Flag</p>
          </div>
          <div class="col-md-4">
            <mat-radio-group formControlName="useNstp">
              <mat-radio-button
                [value]="true"
                fxLayout="row"
                style="margin-right: 20px"
              >
                Yes
              </mat-radio-button>
              <mat-radio-button [value]="false" fxLayout="row">
                No
              </mat-radio-button>

              <!-- other items not shown -->
            </mat-radio-group>
          </div>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card
    formArrayName="charges"
    class="mb-3"
    *ngFor="
      let charge of getSections(transactionConfigurationForm);
      let i = index
    "
  >
    <div [formGroupName]="i">
      <div class="p-1 pb-2 d-flex justify-content-between w-100">
        <mat-form-field>
          <input
            name="chargeTitle"
            matInput
            type="text"
            formControlName="chargeTitle"
          />
        </mat-form-field>
        <div
          class="d-flex text-danger strong-text cursor-pointer"
          (click)="addNewLine(charge.controls.values, i)"
        >
          <span><mat-icon class="icon-display">add</mat-icon></span>
          <span> Add slab</span>
        </div>
      </div>

      <mat-divider></mat-divider>
      <mat-card-content class="pt-3">
        <table
          mat-table
          [dataSource]="dataSources[i]"
          class="mat-elevation-z1 w-100"
          formArrayName="values"
        >
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>Id</th>
            <td mat-cell *matCellDef="let element; let i = index">
              {{ i + 1 }}
            </td>
          </ng-container>

          <ng-container matColumnDef="min">
            <th
              mat-header-cell
              *matHeaderCellDef
              sortActionDescription="Minimum"
            >
              Min
            </th>
            <td
              mat-cell
              *matCellDef="let element; let i = index"
              [formGroupName]="i"
            >
              <mat-form-field style="width: 60%">
                <input
                  name="inputName{{ i }}"
                  matInput
                  type="text"
                  formControlName="minimumAmount"
                />
              </mat-form-field>
            </td>
          </ng-container>

          <ng-container matColumnDef="max">
            <th
              mat-header-cell
              *matHeaderCellDef
              sortActionDescription="Maximum"
            >
              Maximum
            </th>
            <td
              mat-cell
              *matCellDef="let element; let i = index"
              [formGroupName]="i"
            >
              <mat-form-field style="width: 60%">
                <input
                  name="inputName{{ i }}"
                  matInput
                  type="text"
                  formControlName="maximumAmount"
                />
              </mat-form-field>
            </td>
          </ng-container>

          <ng-container matColumnDef="amountPercentage">
            <th
              mat-header-cell
              *matHeaderCellDef
              sortActionDescription="amount percentage"
            >
              % of amount
            </th>
            <td
              mat-cell
              *matCellDef="let element; let i = index"
              [formGroupName]="i"
            >
              <mat-form-field style="width: 60%">
                <input
                  name="inputName{{ i }}"
                  matInput
                  type="text"
                  formControlName="percentCharge"
                />
              </mat-form-field>
            </td>
          </ng-container>

          <ng-container matColumnDef="fixed">
            <th mat-header-cell *matHeaderCellDef sortActionDescription="fixed">
              fixed
            </th>
            <td
              mat-cell
              *matCellDef="let element; let i = index"
              [formGroupName]="i"
            >
              <mat-form-field style="width: 60%">
                <input
                  name="inputName{{ i }}"
                  matInput
                  type="text"
                  formControlName="fixedAmount"
                />
              </mat-form-field>
            </td>
          </ng-container>

          <ng-container matColumnDef="multiplicity">
            <th
              mat-header-cell
              *matHeaderCellDef
              sortActionDescription="multiplicity"
            >
              Multiplicity
            </th>
            <td
              mat-cell
              *matCellDef="let element; let i = index"
              [formGroupName]="i"
            >
              <mat-form-field style="width: 60%">
                <input
                  name="inputName{{ i }}"
                  matInput
                  type="text"
                  formControlName="multiplier"
                />
              </mat-form-field>
            </td>
          </ng-container>

          <ng-container matColumnDef="glAccount">
            <th
              mat-header-cell
              *matHeaderCellDef
              sortActionDescription="glaccount"
            >
              GL Account
            </th>
            <td
              mat-cell
              *matCellDef="let element; let i = index"
              [formGroupName]="i"
            >
              <mat-form-field style="width: 60%">
                <input
                  name="inputName{{ i }}"
                  matInput
                  type="text"
                  formControlName="glAccount"
                />
              </mat-form-field>
            </td>
          </ng-container>

          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let element; let j = index">
              <div>
                <mat-icon
                  svgIcon="three-dots-circled"
                  [matMenuTriggerFor]="menu"
                ></mat-icon>
                <mat-menu #menu="matMenu">
                  <button mat-menu-item (click)="removeRow(j, charge)">
                    <span>Remove</span>
                  </button>
                </mat-menu>
              </div>
            </td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
            class="header-table"
          ></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </mat-card-content>
    </div>
  </mat-card>

  <div class="border rounded search-filter">
    <div
      class="d-flex justify-content-end eyeicon pt-2 pb-3 ps-3"
      (click)="addCharge()"
    >
      <div class="cursor-pointer">
        <mat-icon>add</mat-icon>
      </div>
      <div class="strong-text cursor-pointer">Add Other Charge</div>
    </div>
  </div>
  <div class="d-flex justify-content-end pb-5">
    <div>
      <button
        mat-stroked-button
        color="primary"
        class="px-5 mr-5"
        style="margin-right: 10px"
      >
        Back
      </button>
    </div>
    <div class="d-flex justify-content-between">
      <button
        mat-raised-button
        type="submit"
        color="primary"
        class="px-5"
        (click)="Submit()"
      >
        Submit
      </button>
    </div>
  </div>
</form>
